CREATE OR REPLACE TRIGGER MISE_A_JOUR_ANNONCE_HORAIRE
AFTER UPDATE ON HORAIRE
FOR EACH ROW
DECLARE
    LAST_PREV_ID ANNONCE.ID_ANONCE%TYPE;
    DES ANNONCE.DESCRIP%TYPE;
    TYP ANNONCE.TYP%TYPE;
    TITRE ANNONCE.TITRE%TYPE;
BEGIN
    SELECT MAX(ID_ANONCE) INTO LAST_PREV_ID
    FROM ANNONCE;

    IF :OLD.HEURE_DEPART != :NEW.HEURE_DEPART THEN
        DES := 'L heure de départ du voyage ' || TO_CHAR(:OLD.ID_ITINERAIRE) || ' est modifiée à : ' || TO_CHAR(:NEW.HEURE_DEPART, 'YYYY-MM-DD HH24:MI:SS');
    END IF;

    TYP := 'Modification';
    TITRE := 'Annonce de modification';
    INSERT INTO ANNONCE(ID_ANONCE, ID_ITINERAIRE, TITRE, DESCRIP, DATE_ANONCE, TYP)
    VALUES (LAST_PREV_ID + 1, :NEW.ID_ITINERAIRE, TITRE, DES, SYSDATE, TYP);
END MISE_A_JOUR_ANNONCE_HORAIRE;
